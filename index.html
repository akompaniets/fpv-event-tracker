<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ–∫–µ—Ä –ü–æ–¥—ñ–π FPV</title>
    
    <!-- DOCX –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑ CDN -->
    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            * {
                font-size: 13px;
            }
            
            h1, h2, h3 {
                font-size: 18px;
            }
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 2px;
                background: white;
                font-size: 13px;
            }
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 8px;
                border-radius: 0;
                box-shadow: none;
                max-width: 100%;
            }
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }
        }
        
        .form-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .form-section {
                padding: 15px;
                margin-bottom: 15px;
            }
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .mining-locations {
            display: none;
        }
        
        .mining-locations.active {
            display: block;
        }
        
        .mining-location-group {
            border: 2px solid #2e7d32;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f1f8f4;
        }
        
        .mining-location-group .form-group:last-child {
            margin-bottom: 0;
        }
        
        .single-location {
            display: block;
        }
        
        .single-location.hidden {
            display: none;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .bk-section {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            margin-bottom: 10px;
        }
        
        .bk-rows-container {
            margin-bottom: 10px;
        }
        
        .bk-row {
            display: grid;
            grid-template-columns: 1fr 50px 35px;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .bk-row {
                gap: 6px;
                grid-template-columns: 1fr 45px 30px;
            }
        }
        
        .bk-row select {
            width: 100%;
        }
        
        .bk-row input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            text-align: right;
        }
        
        .bk-row span {
            text-align: left;
        }
        
        .bk-row span {
            font-size: 14px;
            color: #555;
        }
        
        .bk-other-text {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
        }
        
        .targets-section {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            margin-bottom: 10px;
        }
        
        .target-row {
            display: grid;
            grid-template-columns: 1fr 1fr 50px 35px 40px;
            gap: 10px;
            align-items: start;
            margin-bottom: 10px;
        }
        
        .target-row.has-other {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 10px;
        }
        
        .target-row.has-other .target-type {
            grid-column: 1;
            grid-row: 1;
        }
        
        .target-row.has-other .target-other-text {
            grid-column: 2;
            grid-row: 1;
            display: block !important;
        }
        
        .target-row.has-other .target-status {
            grid-column: 1;
            grid-row: 2;
        }
        
        .target-row.has-other .target-count {
            grid-column: 2;
            grid-row: 2;
            justify-self: start;
            width: 80px;
        }
        
        .target-row.has-other .suffix {
            display: none;
        }
        
        .target-row.has-other .delete-target-btn {
            grid-column: 2;
            grid-row: 2;
            justify-self: end;
        }
        
        @media (max-width: 768px) {
            .target-row {
                gap: 3px;
                grid-template-columns: 1fr 1fr 35px 25px 28px;
            }
            
            .target-row.has-other {
                gap: 8px;
            }
        }
        
        .target-row select {
            width: 100%;
        }
        
        .target-other-text {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            width: 100%;
            grid-column: span 2;
        }
        
        @media (max-width: 768px) {
            .target-row select {
                font-size: 13px;
                padding: 8px 3px;
                text-overflow: ellipsis;
                white-space: nowrap;
                overflow: hidden;
            }
        }
        
        .target-row input[type="number"] {
            width: 100%;
            padding: 10px 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            text-align: right;
        }
        
        @media (max-width: 768px) {
            .target-row input[type="number"] {
                padding: 8px 2px;
                font-size: 14px;
            }
        }
        
        .target-row .suffix {
            text-align: left;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .target-row .suffix {
                font-size: 12px;
            }
        }
        
        .target-row .delete-target-btn {
            width: 40px;
            height: 40px;
            padding: 0;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .target-row .delete-target-btn:hover {
            background: #da190b;
        }
        
        @media (max-width: 768px) {
            .target-row .delete-target-btn {
                width: 28px;
                height: 28px;
                font-size: 10px;
            }
        }
        
        .add-bk-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
        }
        
        .add-bk-btn:hover {
            background: #45a049;
        }
        
        @media (max-width: 768px) {
            .add-bk-btn {
                padding: 10px 15px;
            }
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #f44336;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #da190b;
        }
        
        .btn-save {
            background: #2196F3;
            color: white;
            margin-top: 20px;
        }
        
        .btn-save:hover {
            background: #0b7dda;
        }
        
        .events-section {
            margin-top: 30px;
        }
        
        .events-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .events-count {
            color: #757575;
            font-size: 14px;
        }
        
        .events-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .event-card {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
            position: relative;
        }
        
        .event-card h3 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 16px;
            padding-right: 40px;
        }
        
        .delete-event-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .delete-event-btn:hover {
            background: #da190b;
        }
        
        .event-field {
            margin-bottom: 8px;
            font-size: 14px;
            color: #333;
        }
        
        .event-field strong {
            color: #555;
            min-width: 100px;
            display: inline-block;
        }
        
        .no-events {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }
        
        .summary-section {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .summary-section h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .summary-item {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã –¢—Ä–µ–∫–µ—Ä –ü–æ–¥—ñ–π (FPV)</h1>
        
        <div class="form-section">
            <h2 style="margin-bottom: 20px; color: #333; font-size: 18px;">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –µ–∫—ñ–ø–∞–∂</h2>
            
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞ –ø–æ–∑–∏—Ü—ñ—ó</label>
                <input type="text" id="positionName" placeholder="–ù–∞–∑–≤–∞ –ø–æ–∑–∏—Ü—ñ—ó">
            </div>
            
            <div class="form-group">
                <label>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–æ–∑–∏—Ü—ñ—ó</label>
                <input type="text" id="positionCoords" placeholder="–•–•–• –•–• –•–•–•–•–• –•–•–•–•–•" maxlength="18" oninput="formatCoordinatesInputDirect(this)">
            </div>
            
            <div class="form-group">
                <label>–û–ø–µ—Ä–∞—Ç–æ—Ä</label>
                <input type="text" id="operator" placeholder="–∑–≤–∞–Ω–Ω—è –ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ">
            </div>
            
            <div class="form-group">
                <label>–î—Ä—É–≥–∏–π –ø—ñ–ª–æ—Ç</label>
                <input type="text" id="secondPilot" placeholder="–∑–≤–∞–Ω–Ω—è –ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ">
            </div>
            
            <div class="form-group">
                <label>–®—Ç—É—Ä–º–∞–Ω</label>
                <input type="text" id="navigator" placeholder="–∑–≤–∞–Ω–Ω—è –ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ">
            </div>
            
            <div class="form-group">
                <label>–Ü–Ω–∂–µ–Ω–µ—Ä –ë–ö</label>
                <input type="text" id="engineer" placeholder="–∑–≤–∞–Ω–Ω—è –ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ">
            </div>
        </div>
        
        <div class="form-section">
            <h2 style="margin-bottom: 20px; color: #333; font-size: 18px;">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –ø–æ–¥—ñ—é</h2>
            
            <div class="form-group">
                <label>–ü–æ–¥—ñ—è</label>
                <select id="field1" onchange="toggleEventOther()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ø–æ–¥—ñ—ó</option>
                    <option value="–†–æ–∑–≤—ñ–¥–∫–∞">–†–æ–∑–≤—ñ–¥–∫–∞</option>
                    <option value="–£—Ä–∞–∂–µ–Ω–Ω—è">–£—Ä–∞–∂–µ–Ω–Ω—è</option>
                    <option value="–û–±—Ä–∏–≤">–û–±—Ä–∏–≤</option>
                    <option value="–ü–æ–¥–∞–≤–ª–µ–Ω–Ω—è –†–ï–ë">–ü–æ–¥–∞–≤–ª–µ–Ω–Ω—è –†–ï–ë</option>
                    <option value="–¢–µ—Ö–Ω—ñ—á–Ω–∞ –Ω–µ—Å–ø—Ä–∞–≤–Ω—ñ—Å—Ç—å">–¢–µ—Ö–Ω—ñ—á–Ω–∞ –Ω–µ—Å–ø—Ä–∞–≤–Ω—ñ—Å—Ç—å</option>
                    <option value="–ó–±–∏—Ç—Ç—è">–ó–±–∏—Ç—Ç—è</option>
                    <option value="–°—ñ–ª–∞ –±–∞—Ç–∞—Ä–µ—è">–°—ñ–ª–∞ –±–∞—Ç–∞—Ä–µ—è</option>
                    <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
                </select>
            </div>
            
            <!-- –î–æ–¥–∞—Ç–∫–æ–≤–µ –ø–æ–ª–µ –¥–ª—è "–Ü–Ω—à–µ" –ø–æ–¥—ñ—ó -->
            <div class="form-group" id="eventOtherField" style="display: none;">
                <label>–û–ø–∏—Å –ø–æ–¥—ñ—ó</label>
                <input type="text" id="eventOtherText" placeholder="–í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å –ø–æ–¥—ñ—ó">
            </div>
            
            <div class="single-location" id="singleLocation">
                <div class="form-group">
                    <label>–ö–≤–∞–¥—Ä–∞—Ç</label>
                    <input type="text" id="field2" placeholder="–ù–∞–∑–≤–∞ –∫–≤–∞–¥—Ä–∞—Ç—É">
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</label>
                    <input type="text" id="field3" placeholder="–•–•–• –•–• –•–•–•–•–• –•–•–•–•–•" maxlength="18" oninput="formatCoordinatesInputDirect(this)">
                </div>
            </div>
            
            <div class="form-group">
                <label>–ù–µ–±–æ</label>
                <input type="text" id="field4" placeholder="–ß–ß:–•–•" maxlength="5" inputmode="numeric" oninput="formatTimeInputDirect(this)">
            </div>
            
            <div class="form-group">
                <label>–°–∫–∏–¥</label>
                <input type="text" id="field5" placeholder="–ß–ß:–•–•" maxlength="5" inputmode="numeric" oninput="formatTimeInputDirect(this)">
            </div>
            
            <div class="form-group">
                <label>–ó–µ–º–ª—è</label>
                <input type="text" id="field6" placeholder="–ß–ß:–•–•" maxlength="5" inputmode="numeric" oninput="formatTimeInputDirect(this)">
            </div>
            
            <div class="form-group">
                <label>–ë–ö</label>
                <div class="bk-section" id="bkSection">
                    <div class="bk-row" data-row="0">
                        <select class="bk-type" onchange="toggleBkOther(0)">
                            <option value="">-- –û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ë–ö --</option>
                            <option value="–£–ª–∞–º–æ–∫">–£–ª–∞–º–æ–∫</option>
                            <option value="–§—É–≥–∞—Å">–§—É–≥–∞—Å</option>
                            <option value="–ö—É–º—É–ª—å">–ö—É–º—É–ª—å</option>
                            <option value="–¢–µ—Ä–º–æ–±–∞—Ä">–¢–µ—Ä–º–æ–±–∞—Ä</option>
                            <option value="–ö—É–º—É–ª—å-—É–ª–∞–º–æ–∫">–ö—É–º—É–ª—å-—É–ª–∞–º–æ–∫</option>
                            <option value="–°–í–ü">–°–í–ü</option>
                            <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
                        </select>
                        <input type="text" class="bk-other-text" placeholder="–û–ø–∏—Å –ë–ö" style="display: none;">
                        <input type="number" class="bk-count" min="0" max="999" placeholder="0">
                        <span>—à—Ç.</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>–£—Ä–∞–∂–µ–Ω–æ —Ü—ñ–ª–µ–π</label>
                <div class="targets-section" id="targetsSection">
                    <div class="target-row" data-target-row="0">
                        <select class="target-type" onchange="updateTargetStatus(0)">
                            <option value="">-- –û–±–µ—Ä—ñ—Ç—å —Ü—ñ–ª—å --</option>
                            <option value="–ü—ñ—Ö–æ—Ç–∞">–ü—ñ—Ö–æ—Ç–∞</option>
                            <option value="–£–∫—Ä–∏—Ç—Ç—è">–£–∫—Ä–∏—Ç—Ç—è</option>
                            <option value="–¢–∞–Ω–∫">–¢–∞–Ω–∫</option>
                            <option value="–ë–ë–ú">–ë–ë–ú</option>
                            <option value="–†–í—ñ–ê">–†–í—ñ–ê</option>
                            <option value="–ü–ü–û">–ü–ü–û</option>
                            <option value="–ê–¢">–ê–¢</option>
                            <option value="–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞">–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞</option>
                            <option value="–ë–ø–õ–ê">–ë–ø–õ–ê</option>
                            <option value="–ß–æ–≤–µ–Ω (–∫–∞—Ç–µ—Ä)">–ß–æ–≤–µ–Ω (–∫–∞—Ç–µ—Ä)</option>
                            <option value="–í–µ—Ä—Ç–æ–ª—ñ—Ç">–í–µ—Ä—Ç–æ–ª—ñ—Ç</option>
                            <option value="–ü–¢–ó">–ü–¢–ó</option>
                            <option value="–°—Ç—Ä—ñ–ª–µ—Ü—å–∫–∞ –∑–±—Ä–æ—è">–°—Ç—Ä—ñ–ª–µ—Ü—å–∫–∞ –∑–±—Ä–æ—è</option>
                            <option value="–¢–ó–ü">–¢–ó–ü</option>
                            <option value="–ñ–¥—É–Ω">–ñ–¥—É–Ω</option>
                            <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
                        </select>
                        <input type="text" class="target-other-text" placeholder="–û–ø–∏—Å —Ü—ñ–ª—ñ" style="display: none;">
                        <select class="target-status">
                            <option value="">-- –°—Ç–∞—Ç—É—Å --</option>
                            <option value="–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ">–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ</option>
                            <option value="–ó–Ω–∏—â–µ–Ω–æ">–ó–Ω–∏—â–µ–Ω–æ</option>
                        </select>
                        <input type="number" class="target-count" min="0" max="99" placeholder="0">
                        <span class="suffix">–æ–¥.</span>
                        <button class="delete-target-btn" onclick="removeTargetRow(0)" style="visibility: hidden;">‚úï</button>
                    </div>
                    <button class="add-bk-btn" onclick="addTargetRow()">+ –î–æ–¥–∞—Ç–∏ —Ü—ñ–ª—å</button>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="addEvent()">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ–¥—ñ—é</button>
                <button class="btn-secondary" onclick="clearForm()">–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É</button>
                <button class="btn-save" onclick="saveToFile()">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç</button>
            </div>
        </div>
        
        <div class="events-section">
            <div class="events-header">
                <h2 style="color: #333; font-size: 18px;">–î–æ–¥–∞–Ω—ñ –ø–æ–¥—ñ—ó</h2>
                <span class="events-count" id="eventsCount">–í—Å—å–æ–≥–æ: 0</span>
            </div>
            <div class="events-list" id="eventsList">
                <div class="no-events">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –¥–æ–¥–∞–Ω–∏—Ö –ø–æ–¥—ñ–π</div>
            </div>
        </div>
    </div>
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 0 20px; color: #999; font-size: 10px;">
        <div>Powered by CHEF</div>
        <div>Ver: 0.0.5</div>
    </div>

    <script>
        let events = [];
        let targetRowCounter = 1;
        
        function updateTargetStatus(rowId) {
            const row = document.querySelector(`[data-target-row="${rowId}"]`);
            if (!row) return;
            
            const targetType = row.querySelector('.target-type').value;
            const statusSelect = row.querySelector('.target-status');
            const suffix = row.querySelector('.suffix');
            const otherText = row.querySelector('.target-other-text');
            const countInput = row.querySelector('.target-count');
            
            statusSelect.innerHTML = '<option value="">-- –°—Ç–∞—Ç—É—Å --</option>';
            
            if (targetType === '–Ü–Ω—à–µ') {
                row.classList.add('has-other');
                otherText.style.display = 'block';
            } else {
                row.classList.remove('has-other');
                otherText.style.display = 'none';
            }
            
            if (targetType === '–ü—ñ—Ö–æ—Ç–∞') {
                statusSelect.innerHTML += '<option value="200">200</option>';
                statusSelect.innerHTML += '<option value="300">300</option>';
                suffix.textContent = '—á–æ–ª.';
            } else if (targetType) {
                statusSelect.innerHTML += '<option value="–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ">–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ</option>';
                statusSelect.innerHTML += '<option value="–ó–Ω–∏—â–µ–Ω–æ">–ó–Ω–∏—â–µ–Ω–æ</option>';
                suffix.textContent = '–æ–¥.';
            } else {
                suffix.textContent = '–æ–¥.';
            }
            
            if (targetType && (!countInput.value || countInput.value === '0')) {
                countInput.value = '1';
            }
        }
        
        function addTargetRow() {
            const targetsSection = document.getElementById('targetsSection');
            const addButton = targetsSection.querySelector('.add-bk-btn');
            
            const newRow = document.createElement('div');
            newRow.className = 'target-row';
            newRow.setAttribute('data-target-row', targetRowCounter);
            
            newRow.innerHTML = `
                <select class="target-type" onchange="updateTargetStatus(${targetRowCounter})">
                    <option value="">-- –û–±–µ—Ä—ñ—Ç—å —Ü—ñ–ª—å --</option>
                    <option value="–ü—ñ—Ö–æ—Ç–∞">–ü—ñ—Ö–æ—Ç–∞</option>
                    <option value="–£–∫—Ä–∏—Ç—Ç—è">–£–∫—Ä–∏—Ç—Ç—è</option>
                    <option value="–¢–∞–Ω–∫">–¢–∞–Ω–∫</option>
                    <option value="–ë–ë–ú">–ë–ë–ú</option>
                    <option value="–†–í—ñ–ê">–†–í—ñ–ê</option>
                    <option value="–ü–ü–û">–ü–ü–û</option>
                    <option value="–ê–¢">–ê–¢</option>
                    <option value="–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞">–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞</option>
                    <option value="–ë–ø–õ–ê">–ë–ø–õ–ê</option>
                    <option value="–ß–æ–≤–µ–Ω (–∫–∞—Ç–µ—Ä)">–ß–æ–≤–µ–Ω (–∫–∞—Ç–µ—Ä)</option>
                    <option value="–í–µ—Ä—Ç–æ–ª—ñ—Ç">–í–µ—Ä—Ç–æ–ª—ñ—Ç</option>
                    <option value="–ü–¢–ó">–ü–¢–ó</option>
                    <option value="–°—Ç—Ä—ñ–ª–µ—Ü—å–∫–∞ –∑–±—Ä–æ—è">–°—Ç—Ä—ñ–ª–µ—Ü—å–∫–∞ –∑–±—Ä–æ—è</option>
                    <option value="–¢–ó–ü">–¢–ó–ü</option>
                    <option value="–ñ–¥—É–Ω">–ñ–¥—É–Ω</option>
                    <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
                </select>
                <input type="text" class="target-other-text" placeholder="–û–ø–∏—Å —Ü—ñ–ª—ñ" style="display: none;">
                <select class="target-status">
                    <option value="">-- –°—Ç–∞—Ç—É—Å --</option>
                    <option value="–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ">–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ</option>
                    <option value="–ó–Ω–∏—â–µ–Ω–æ">–ó–Ω–∏—â–µ–Ω–æ</option>
                </select>
                <input type="number" class="target-count" min="0" max="99" placeholder="0">
                <span class="suffix">–æ–¥.</span>
                <button class="delete-target-btn" onclick="removeTargetRow(${targetRowCounter})">‚úï</button>
            `;
            
            targetsSection.insertBefore(newRow, addButton);
            targetRowCounter++;
        }
        
        function removeTargetRow(rowId) {
            const row = document.querySelector(`[data-target-row="${rowId}"]`);
            if (row) {
                row.remove();
            }
        }
        
        function toggleEventOther() {
            const eventType = document.getElementById('field1').value;
            const eventOtherField = document.getElementById('eventOtherField');
            
            if (eventType === '–Ü–Ω—à–µ') {
                eventOtherField.style.display = 'block';
            } else {
                eventOtherField.style.display = 'none';
            }
        }
        
        function formatCoordinatesInputDirect(field) {
            formatCoordinatesInput(field);
        }
        
        function formatTimeInputDirect(field) {
            formatTimeInput({ target: field });
        }
        
        function toggleBkOther(rowId) {
            const row = document.querySelector(`[data-row="${rowId}"]`);
            if (!row) return;
            
            const bkType = row.querySelector('.bk-type').value;
            const otherText = row.querySelector('.bk-other-text');
            const countInput = row.querySelector('.bk-count');
            
            if (bkType === '–Ü–Ω—à–µ') {
                otherText.style.display = 'block';
            } else {
                otherText.style.display = 'none';
            }
            
            if (bkType && (!countInput.value || countInput.value === '0')) {
                countInput.value = '1';
            }
        }
        
        function addEvent() {
            const originalEventType = document.getElementById('field1').value;
            let eventType = originalEventType;
            
            if (eventType === '–Ü–Ω—à–µ') {
                const otherText = document.getElementById('eventOtherText').value.trim();
                if (otherText) {
                    eventType = otherText;
                } else {
                    alert('‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å –ø–æ–¥—ñ—ó!');
                    return;
                }
            }
            
            const event = {
                –ø–æ–¥—ñ—è: eventType,
                –Ω–µ–±–æ: document.getElementById('field4').value.trim(),
                —Å–∫–∏–¥: document.getElementById('field5').value.trim(),
                –∑–µ–º–ª—è: document.getElementById('field6').value.trim(),
                –±–∫: [],
                —Ü—ñ–ª—ñ: []
            };
            
            const targetRows = document.querySelectorAll('.target-row');
            targetRows.forEach(row => {
                let type = row.querySelector('.target-type').value;
                const status = row.querySelector('.target-status').value;
                const count = parseInt(row.querySelector('.target-count').value) || 0;
                const suffix = row.querySelector('.suffix').textContent;
                const otherText = row.querySelector('.target-other-text');
                
                if (type === '–Ü–Ω—à–µ' && otherText && otherText.value.trim()) {
                    type = otherText.value.trim();
                }
                
                if (type && status && count > 0) {
                    event.—Ü—ñ–ª—ñ.push({
                        —Ç–∏–ø: type,
                        —Å—Ç–∞—Ç—É—Å: status,
                        –∫—ñ–ª—å–∫—ñ—Å—Ç—å: count,
                        —Å—É—Ñ—ñ–∫—Å: suffix
                    });
                }
            });
            
            event.–∫–≤–∞–¥—Ä–∞—Ç = document.getElementById('field2').value.trim();
            event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ = document.getElementById('field3').value.trim();
            
            if (!event.—Å–∫–∏–¥ && event.–Ω–µ–±–æ) {
                event.—Å–∫–∏–¥ = event.–Ω–µ–±–æ;
            }
            
            if (event.–Ω–µ–±–æ && event.—Å–∫–∏–¥) {
                const timeNebo = parseTime(event.–Ω–µ–±–æ);
                const timeSkyd = parseTime(event.—Å–∫–∏–¥);
                
                if (timeSkyd < timeNebo) {
                    alert('‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: –ß–∞—Å "–°–∫–∏–¥" –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—à–∏–º –∑–∞ "–ù–µ–±–æ"!');
                    return;
                }
            }
            
            if (event.—Å–∫–∏–¥ && event.–∑–µ–º–ª—è) {
                const timeSkyd = parseTime(event.—Å–∫–∏–¥);
                const timeZemlya = parseTime(event.–∑–µ–º–ª—è);
                
                if (timeZemlya < timeSkyd) {
                    alert('‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: –ß–∞—Å "–ó–µ–º–ª—è" –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—à–∏–º –∑–∞ "–°–∫–∏–¥"!');
                    return;
                }
            }
            
            const bkRow = document.querySelector('.bk-row');
            let bkType = bkRow.querySelector('.bk-type').value;
            const bkCount = parseInt(bkRow.querySelector('.bk-count').value) || 0;
            const otherText = bkRow.querySelector('.bk-other-text');
            
            if (bkType === '–Ü–Ω—à–µ' && otherText && otherText.value.trim()) {
                bkType = otherText.value.trim();
            }
            
            if (bkType && bkCount > 0) {
                event.–±–∫.push({ type: bkType, count: bkCount });
            }
            
            const hasData = event.–ø–æ–¥—ñ—è || event.–∫–≤–∞–¥—Ä–∞—Ç || event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ || 
                           event.–Ω–µ–±–æ || event.—Å–∫–∏–¥ || event.–∑–µ–º–ª—è || 
                           event.–∫–æ–º–µ–Ω—Ç–∞—Ä || event.–±–∫.length > 0;
            
            if (!hasData) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω–µ –ø–æ–ª–µ!');
                return;
            }
            
            events.push(event);
            updateEventsList();
            clearForm();
            
            const count = events.length;
            alert(`‚úÖ –ü–æ–¥—ñ—é #${count} –¥–æ–¥–∞–Ω–æ!`);
        }
        
        function formatCrewName(name) {
            if (!name || !name.trim()) return '';
            
            const words = name.trim().split(/\s+/);
            if (words.length === 0) return '';
            
            const firstWord = words[0].toLowerCase();
            
            const restWords = words.slice(1).map(word => {
                if (word.length === 0) return '';
                return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
            });
            
            return [firstWord, ...restWords].join(' ');
        }
        
        function parseTime(timeStr) {
            if (!timeStr || !timeStr.includes(':')) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        function deleteEvent(index) {
            if (confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–¥—ñ—é #${index + 1}?`)) {
                events.splice(index, 1);
                updateEventsList();
                alert('‚úÖ –ü–æ–¥—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ!');
            }
        }
        
        function clearForm() {
            document.getElementById('field1').value = '';
            document.getElementById('field2').value = '';
            document.getElementById('field3').value = '';
            document.getElementById('field4').value = '';
            document.getElementById('field5').value = '';
            document.getElementById('field6').value = '';
            
            document.getElementById('singleLocation').classList.remove('hidden');
            
            const bkRow = document.querySelector('.bk-row');
            bkRow.querySelector('.bk-type').value = '';
            bkRow.querySelector('.bk-count').value = '';
            bkRow.querySelector('.bk-other-text').style.display = 'none';
            
            const targetsSection = document.getElementById('targetsSection');
            const allTargetRows = targetsSection.querySelectorAll('.target-row');
            
            allTargetRows.forEach((row, index) => {
                if (index > 0) {
                    row.remove();
                }
            });
            
            const firstTargetRow = targetsSection.querySelector('.target-row');
            firstTargetRow.querySelector('.target-type').value = '';
            firstTargetRow.querySelector('.target-status').value = '';
            firstTargetRow.querySelector('.target-count').value = '';
            firstTargetRow.querySelector('.suffix').textContent = '–æ–¥.';
            
            targetRowCounter = 1;
        }
        
        function updateEventsList() {
            const listDiv = document.getElementById('eventsList');
            const countSpan = document.getElementById('eventsCount');
            
            countSpan.textContent = `–í—Å—å–æ–≥–æ: ${events.length}`;
            
            if (events.length === 0) {
                listDiv.innerHTML = '<div class="no-events">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –¥–æ–¥–∞–Ω–∏—Ö –ø–æ–¥—ñ–π</div>';
                return;
            }
            
            let html = '';
            events.forEach((event, index) => {
                html += `
                    <div class="event-card">
                        <button class="delete-event-btn" onclick="deleteEvent(${index})">‚úï</button>
                        <h3>–ü–æ–¥—ñ—è #${index + 1}</h3>
                        <div class="event-field"><strong>–ø–æ–¥—ñ—è:</strong> ${event.–ø–æ–¥—ñ—è || '‚Äî'}</div>`;
                
                html += `<div class="event-field"><strong>–∫–≤–∞–¥—Ä–∞—Ç:</strong> ${event.–∫–≤–∞–¥—Ä–∞—Ç || '‚Äî'}</div>`;
                html += `<div class="event-field"><strong>–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:</strong> ${event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ || '‚Äî'}</div>`;
                
                html += `<div class="event-field"><strong>–Ω–µ–±–æ:</strong> ${event.–Ω–µ–±–æ || '‚Äî'}</div>
                        <div class="event-field"><strong>—Å–∫–∏–¥:</strong> ${event.—Å–∫–∏–¥ || '‚Äî'}</div>
                        <div class="event-field"><strong>–∑–µ–º–ª—è:</strong> ${event.–∑–µ–º–ª—è || '‚Äî'}</div>
                        <div class="event-field"><strong>–±–∫:</strong> ${formatBK(event.–±–∫)}</div>`;
                
                if (event.—Ü—ñ–ª—ñ && event.—Ü—ñ–ª—ñ.length > 0) {
                    const targetsStr = event.—Ü—ñ–ª—ñ.map(t => `${t.—Ç–∏–ø}: ${t.—Å—Ç–∞—Ç—É—Å} - ${t.–∫—ñ–ª—å–∫—ñ—Å—Ç—å} ${t.—Å—É—Ñ—ñ–∫—Å}`).join(', ');
                    html += `<div class="event-field"><strong>—Ü—ñ–ª—ñ:</strong> ${targetsStr}</div>`;
                }
                
                html += `</div>
                `;
            });
            
            html += generateBKSummary();
            
            listDiv.innerHTML = html;
        }
        
        function formatBK(bkArray) {
            if (bkArray.length === 0) return '‚Äî';
            return bkArray.map(item => `${item.type} - ${item.count} —à—Ç`).join(', ');
        }
        
        function generateBKSummary() {
            const bkTotals = {};
            
            events.forEach(event => {
                event.–±–∫.forEach(item => {
                    if (bkTotals[item.type]) {
                        bkTotals[item.type] += item.count;
                    } else {
                        bkTotals[item.type] = item.count;
                    }
                });
            });
            
            if (Object.keys(bkTotals).length === 0) {
                return '';
            }
            
            let html = '<div class="summary-section">';
            html += '<h4>–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ë–ö:</h4>';
            
            const sortedTypes = Object.keys(bkTotals).sort();
            
            sortedTypes.forEach(type => {
                html += `<div class="summary-item">- ${type}: ${bkTotals[type]} —à—Ç</div>`;
            });
            
            html += '</div>';
            
            return html;
        }
        
        function saveToFile() {
            if (events.length === 0) {
                alert('‚ö†Ô∏è –ù–µ–º–∞—î –ø–æ–¥—ñ–π –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è!');
                return;
            }
            
            if (typeof docx !== 'undefined' || typeof window.docx !== 'undefined') {
                saveToFileDOCX();
            } else {
                saveToFileHTML();
            }
        }
        
        async function saveToFileDOCX() {
            if (typeof docx === 'undefined' && typeof window.docx === 'undefined') {
                console.log('DOCX –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ HTML –≤–µ—Ä—Å—ñ—é');
                saveToFileHTML();
                return;
            }
            
            const docxLib = typeof docx !== 'undefined' ? docx : window.docx;
            
            try {
                const { Document, Paragraph, TextRun, AlignmentType, UnderlineType, convertInchesToTwip } = docxLib;
            
            const positionName = document.getElementById('positionName').value.trim() || '‚Äî';
            const positionCoords = document.getElementById('positionCoords').value.trim();
            const operator = document.getElementById('operator').value.trim();
            const secondPilot = document.getElementById('secondPilot').value.trim();
            const navigator = document.getElementById('navigator').value.trim();
            const engineer = document.getElementById('engineer').value.trim();
            
            const strikeEvents = ['–†–æ–∑–≤—ñ–¥–∫–∞', '–£—Ä–∞–∂–µ–Ω–Ω—è'];
            
            const flightCount = events.filter(e => strikeEvents.includes(e.–ø–æ–¥—ñ—è)).length;
            const totalEventsCount = events.length; // –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—Å—ñ—Ö –ø–æ–¥—ñ–π –¥–ª—è –≤—Ç—Ä–∞—Ç –¥—Ä–æ–Ω—ñ–≤
            const timesText = declineTimes(flightCount);
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: '2-digit' }).replace(/\//g, '.');
            
            const yesterday = new Date(now);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: '2-digit' }).replace(/\//g, '.');
            
            const flightsText = declineFlights(flightCount);
            const coordsText = positionCoords ? ` (${positionCoords})` : '';
            
            const paragraphs = [];
            
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "    –ü–Ü–î–°–£–ú–ö–û–í–ï –î–û–ù–ï–°–ï–ù–ù–Ø ‚Ññ_____ 1 –ë–ë–øC 1 –û–®–ü –†–æ—Ç–∞: FPV",
                    bold: true,
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: `1. –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è: 16:00 ${yesterdayStr} –ø–æ 16:00 ${dateStr}.`,
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "2. –ù–∞–ø—Ä—è–º–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "3. –ó–∞–¥—ñ—è–Ω–æ —Å–∏–ª –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "    –ï–∫—ñ–ø–∞–∂—ñ–≤ - 1",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: `    –ë–ø–õ–ê ‚Äì ${totalEventsCount}`,
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: `    –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–ª—å–æ—Ç—ñ–≤ ‚Äì ${totalEventsCount}`,
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 },
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "4. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –∑–∞ –¥–æ–±—É:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            const targetSummary = {};
            const infantryStatus = { "200": 0, "300": 0 };
            
            events.forEach(event => {
                if (event.—Ü—ñ–ª—ñ && event.—Ü—ñ–ª—ñ.length > 0) {
                    event.—Ü—ñ–ª—ñ.forEach(target => {
                        if (target.—Ç–∏–ø === '–ü—ñ—Ö–æ—Ç–∞') {
                            if (target.—Å—Ç–∞—Ç—É—Å === '200') {
                                infantryStatus["200"] += target.–∫—ñ–ª—å–∫—ñ—Å—Ç—å;
                            } else if (target.—Å—Ç–∞—Ç—É—Å === '300') {
                                infantryStatus["300"] += target.–∫—ñ–ª—å–∫—ñ—Å—Ç—å;
                            }
                        } else {
                            if (target.—Å—Ç–∞—Ç—É—Å === '–ó–Ω–∏—â–µ–Ω–æ') {
                                const key = target.—Ç–∏–ø;
                                targetSummary[key] = (targetSummary[key] || 0) + target.–∫—ñ–ª—å–∫—ñ—Å—Ç—å;
                            } else if (target.—Å—Ç–∞—Ç—É—Å === '–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ') {
                                const key = `–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ ${target.—Ç–∏–ø}`;
                                targetSummary[key] = (targetSummary[key] || 0) + target.–∫—ñ–ª—å–∫—ñ—Å—Ç—å;
                            }
                        }
                    });
                }
            });
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "5. –í—Ç—Ä–∞—Ç–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            if (infantryStatus["200"] > 0 || infantryStatus["300"] > 0) {
                let infantryText = "    ";
                if (infantryStatus["200"] > 0) infantryText += `–û\\c –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ 200 ‚Äì ${infantryStatus["200"]}`;
                if (infantryStatus["300"] > 0) {
                    if (infantryStatus["200"] > 0) infantryText += "\n    ";
                    infantryText += `–û\\c –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ 300 ‚Äì ${infantryStatus["300"]}`;
                }
                
                paragraphs.push(new Paragraph({
                    children: [new TextRun({
                        text: infantryText,
                        font: "Times New Roman",
                        size: 24
                    })],
                    spacing: { after: 120 },
                }));
            }
            
            const allTargets = [
                '–£–∫—Ä–∏—Ç—Ç—è', '–¢–∞–Ω–∫', '–ë–ë–ú', '–†–í—ñ–ê', '–ü–ü–û', '–ê–¢', '–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞', 
                '–ë–ø–õ–ê', '–ß–æ–≤–µ–Ω (–∫–∞—Ç–µ—Ä)', '–í–µ—Ä—Ç–æ–ª—ñ—Ç', '–ü–¢–ó', '–°—Ç—Ä—ñ–ª–µ—Ü—å–∫–∞ –∑–±—Ä–æ—è', '–¢–ó–ü', '–ñ–¥—É–Ω', '–Ü–Ω—à–µ'
            ];
            
            allTargets.forEach(targetType => {
                const destroyedCount = targetSummary[targetType] || 0;
                if (destroyedCount > 0) {
                    paragraphs.push(new Paragraph({
                        children: [new TextRun({
                            text: `    ${targetType} ‚Äì ${destroyedCount}`,
                            font: "Times New Roman",
                            size: 24
                        })],
                        spacing: { after: 120 }
                    }));
                }
            });
            
            Object.keys(targetSummary).forEach(targetKey => {
                if (!allTargets.includes(targetKey) && !targetKey.startsWith('–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ ')) {
                    const count = targetSummary[targetKey];
                    paragraphs.push(new Paragraph({
                        children: [new TextRun({
                            text: `    ${targetKey} ‚Äì ${count}`,
                            font: "Times New Roman",
                            size: 24
                        })],
                        spacing: { after: 120 }
                    }));
                }
            });
            
            Object.keys(targetSummary).forEach(targetKey => {
                if (targetKey.startsWith('–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ ') && !allTargets.some(t => targetKey === `–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ ${t}`)) {
                    const count = targetSummary[targetKey];
                    paragraphs.push(new Paragraph({
                        children: [new TextRun({
                            text: `    ${targetKey} ‚Äì ${count}`,
                            font: "Times New Roman",
                            size: 24
                        })],
                        spacing: { after: 120 }
                    }));
                }
            });
            
            const eventCounts = {};
            
            events.forEach(event => {
                const eventType = event.–ø–æ–¥—ñ—è || '';
                eventCounts[eventType] = (eventCounts[eventType] || 0) + 1;
            });
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "5. –í–∏—Ç—Ä–∞—Ç–∏ –ë–ö:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            const bkTotals = {};
            events.forEach(event => {
                if (event.–±–∫ && event.–±–∫.length > 0) {
                    event.–±–∫.forEach(bk => {
                        bkTotals[bk.type] = (bkTotals[bk.type] || 0) + bk.count;
                    });
                }
            });
            
            Object.keys(bkTotals).sort().forEach(bkType => {
                paragraphs.push(new Paragraph({
                    children: [new TextRun({
                        text: `    ${bkType} ‚Äì ${bkTotals[bkType]} —à—Ç.`,
                        font: "Times New Roman",
                        size: 24
                    })],
                    spacing: { after: 120 },
                }));
            });
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "6. –í—Ç—Ä–∞—Ç–∏:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "    –û—Å–æ–±–æ–≤–∏–π —Å–∫–ª–∞–¥ ‚Äì",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: `    –û—ñ–í–¢ ‚Äì`,
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: `    –î—Ä–æ–Ω–∏ ‚Äì ${totalEventsCount > 0 ? totalEventsCount : ''}`,
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "    7. –ü—Ä–æ–±–ª–µ–º–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "    - –í–∏—Å–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–æ—Ä–æ–∂–∏—Ö FPV",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "    - –í–∏—Å–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–æ—Ä–æ–∂–∏—Ö –∫—Ä–∏–ª",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "    - –¢—Ä—É–¥–Ω–æ—â—ñ –≤ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—ñ –ø–æ–∑–∏—Ü—ñ–π, —á–µ—Ä–µ–∑ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤–æ—Ä–æ–∂–∏—Ö –ë–ü–õ–ê –Ω–∞ –ª–æ–≥—ñ—Å—Ç–∏—á–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({
                    text: "8. –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –¥—ñ—ó:",
                    font: "Times New Roman",
                    size: 24
                })],
                spacing: { after: 120 }
            }));
            
            paragraphs.push(new Paragraph({ text: "", spacing: { after: 240 } }));
            paragraphs.push(new Paragraph({ text: "", spacing: { after: 240 } }));
            
            
            paragraphs.push(new Paragraph({
                children: [
                    new TextRun({
                        text: `    –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª–æ–º 2 –ë–ë–ø–° –¢–ó–ü FPV ¬´${positionName}¬ª${coordsText} –±—É–ª–æ –∑–¥—ñ–π—Å–Ω–µ–Ω–æ —É–¥–∞—Ä–∏ FPV-–¥—Ä–æ–Ω–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É ‚Äì ${flightCount} ${timesText}.`,
                        bold: true,
                        font: "Times New Roman",
                        size: 24
                    })
                ],
                spacing: { after: 120 }
            }));
            
            if (operator) {
                paragraphs.push(new Paragraph({
                    children: [new TextRun({ text: `    –æ–ø–µ—Ä–∞—Ç–æ—Ä ‚Äì ${formatCrewName(operator)}`, font: "Times New Roman", size: 24 })],
                    spacing: { after: 120 }
                }));
            }
            if (secondPilot) {
                paragraphs.push(new Paragraph({
                    children: [new TextRun({ text: `    –¥—Ä—É–≥–∏–π –ø—ñ–ª–æ—Ç ‚Äì ${formatCrewName(secondPilot)}`, font: "Times New Roman", size: 24 })],
                    spacing: { after: 120 }
                }));
            }
            if (navigator) {
                paragraphs.push(new Paragraph({
                    children: [new TextRun({ text: `    —à—Ç—É—Ä–º–∞–Ω ‚Äì ${formatCrewName(navigator)}`, font: "Times New Roman", size: 24 })],
                    spacing: { after: 120 }
                }));
            }
            if (engineer) {
                paragraphs.push(new Paragraph({
                    children: [new TextRun({ text: `    —ñ–Ω–∂–µ–Ω–µ—Ä –ë–ö ‚Äì ${formatCrewName(engineer)}`, font: "Times New Roman", size: 24 })],
                    spacing: { after: 240 }
                }));
            } else {
                paragraphs.push(new Paragraph({ text: "", spacing: { after: 240 } }));
            }
            
            paragraphs.push(new Paragraph({
                children: [new TextRun({ 
                    text: `–ü—Ä–æ—Ç—è–≥–æ–º –∑–≤—ñ—Ç–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É –∑ 16:00 ${yesterdayStr}—Ä. –ø–æ 16:00 ${dateStr}—Ä. –±—É–ª–æ –∑–¥—ñ–π—Å–Ω–µ–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω–µ:`, 
                    font: "Times New Roman", 
                    size: 24
                })],
                spacing: { after: 240 }
            }));
            
            const sortedEvents = [...events].sort((a, b) => {
                const timeA = parseTime(a.–Ω–µ–±–æ || a.—Å–∫–∏–¥ || a.–∑–µ–º–ª—è || '00:00');
                const timeB = parseTime(b.–Ω–µ–±–æ || b.—Å–∫–∏–¥ || b.–∑–µ–º–ª—è || '00:00');
                return timeA - timeB;
            });
            
            sortedEvents.forEach(event => {
                let eventTypeLower = event.–ø–æ–¥—ñ—è.toLowerCase();
                if (eventTypeLower === '—Ä–æ–∑–≤—ñ–¥–∫–∞') {
                    eventTypeLower = '–ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è —Ä–æ–∑–≤—ñ–¥–∫–∏';
                }
                const timeText = event.–Ω–µ–±–æ || '—Ö—Ö:—Ö—Ö';
                
                if (event.—Ü—ñ–ª—ñ && event.—Ü—ñ–ª—ñ.length > 0) {
                    event.—Ü—ñ–ª—ñ.forEach(target => {
                        const targetCoords = event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ ? ` –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (${event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏})` : ' –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (–•–•–• –•–• –•–•–•–•–• –•–•–•–•–•)';
                        paragraphs.push(new Paragraph({
                            children: [new TextRun({ 
                                text: `${timeText} ‚Äì —É—Ä–∞–∂–µ–Ω–Ω—è ${target.—Ç–∏–ø.toLowerCase()}${targetCoords}`, 
                                font: "Times New Roman", 
                                size: 24 
                            })],
                            spacing: { after: 120 }
                        }));
                    });
                } else {
                    const coordsText = event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ ? ` –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (${event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏})` : ' –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (–•–•–• –•–• –•–•–•–•–• –•–•–•–•–•)';
                    
                    paragraphs.push(new Paragraph({
                        children: [new TextRun({ 
                            text: `${timeText} ‚Äì ${eventTypeLower}${coordsText}`, 
                            font: "Times New Roman", 
                            size: 24 
                        })],
                        spacing: { after: 120 }
                    }));
                }
            });
            
            paragraphs.push(new Paragraph({ text: "", spacing: { after: 240 } }));
            
            const doc = new Document({
                sections: [{
                    properties: {
                        page: {
                            margin: {
                                top: convertInchesToTwip(1),
                                right: convertInchesToTwip(1),
                                bottom: convertInchesToTwip(1),
                                left: convertInchesToTwip(1)
                            }
                        }
                    },
                    children: paragraphs
                }]
            });
            
            const blob = await docxLib.Packer.toBlob(doc);
            const positionFileName = positionName.replace(/[^a-zA-Z–∞-—è–ê-–Ø—ñ–Ü—ó–á—î–Ñ0-9]/g, '_');
            
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const fileDate = `${day}-${month}-${year}`;
            
            saveAs(blob, `fpv_${positionFileName}_${fileDate}.docx`);
            console.log('DOCX file generated successfully');
            
            } catch (error) {
                console.error('Error generating DOCX:', error);
                alert('‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ DOCX —Ñ–∞–π–ª—É: ' + error.message);
            }
        }
        
        function saveToFileHTML() {
            if (events.length === 0) {
                alert('‚ö†Ô∏è –ù–µ–º–∞—î –ø–æ–¥—ñ–π –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è!');
                return;
            }
            
            const positionName = document.getElementById('positionName').value.trim() || '‚Äî';
            const positionCoords = document.getElementById('positionCoords').value.trim();
            
            const strikeEvents = ['–†–æ–∑–≤—ñ–¥–∫–∞', '–£—Ä–∞–∂–µ–Ω–Ω—è'];
            
            const flightCount = events.filter(e => strikeEvents.includes(e.–ø–æ–¥—ñ—è)).length;
            const totalEventsCount = events.length; // –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—Å—ñ—Ö –ø–æ–¥—ñ–π –¥–ª—è –≤—Ç—Ä–∞—Ç –¥—Ä–æ–Ω—ñ–≤
            const timesText = declineTimes(flightCount);
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//g, '.');
            const yesterday = new Date(now);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//g, '.');
            
            const eventCounts = {};
            let infantryEventCount = 0;
            
            events.forEach(event => {
                const eventType = event.–ø–æ–¥—ñ—è || '';
                eventCounts[eventType] = (eventCounts[eventType] || 0) + 1;
                
                if (eventType === '–£—Ä–∞–∂–µ–Ω–Ω—è' && event.—Ü—ñ–ª—ñ) {
                    const hasInfantry = event.—Ü—ñ–ª—ñ.some(t => t.—Ç–∏–ø === '–ü—ñ—Ö–æ—Ç–∞');
                    if (hasInfantry) infantryEventCount++;
                }
            });
            
            const targetSummary = {};
            const infantryKills = { "200": 0, "300": 0 };
            
            events.forEach(event => {
                if (event.—Ü—ñ–ª—ñ && event.—Ü—ñ–ª—ñ.length > 0) {
                    event.—Ü—ñ–ª—ñ.forEach(target => {
                        if (target.—Ç–∏–ø === '–ü—ñ—Ö–æ—Ç–∞') {
                            if (target.—Å—Ç–∞—Ç—É—Å === '200') infantryKills["200"] += target.–∫—ñ–ª—å–∫—ñ—Å—Ç—å;
                            if (target.—Å—Ç–∞—Ç—É—Å === '300') infantryKills["300"] += target.–∫—ñ–ª—å–∫—ñ—Å—Ç—å;
                        } else {
                            const key = target.—Å—Ç–∞—Ç—É—Å === '–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ' ? `–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ_${target.—Ç–∏–ø}` : target.—Ç–∏–ø;
                            targetSummary[key] = (targetSummary[key] || 0) + target.–∫—ñ–ª—å–∫—ñ—Å—Ç—å;
                        }
                    });
                }
            });
            
            const techTypes = ['–¢–∞–Ω–∫', '–ë–ë–ú', '–†–í—ñ–ê', '–ü–ü–û', '–ê–¢', '–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞', '–ë–ø–õ–ê', '–ß–æ–≤–µ–Ω (–∫–∞—Ç–µ—Ä)', '–í–µ—Ä—Ç–æ–ª—ñ—Ç', '–ü–¢–ó'];
            let oivtTotal = 0;
            techTypes.forEach(type => {
                oivtTotal += (targetSummary[type] || 0);
                oivtTotal += (targetSummary[`–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ_${type}`] || 0);
            });
            
            const bkSummary = {};
            events.forEach(event => {
                if (event.–±–∫ && event.–±–∫.length > 0) {
                    event.–±–∫.forEach(item => {
                        bkSummary[item.type] = (bkSummary[item.type] || 0) + item.count;
                    });
                }
            });
            
            let html = `<html><head><meta charset='utf-8'><style>
                body { font-family: 'Times New Roman'; font-size: 12pt; }
                p { margin: 2pt 0; }
            </style></head><body>
            
<p><b>–ü–Ü–î–°–£–ú–ö–û–í–ï –î–û–ù–ï–°–ï–ù–ù–Ø ‚Ññ_____ 1 –ë–ë–øC 1 –û–®–ü –†–æ—Ç–∞: FPV</b></p>

<p>1. –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è: 16:00 ${yesterdayStr} –ø–æ 16:00 ${dateStr}.</p>

<p>2. –ù–∞–ø—Ä—è–º–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è:</p>

<p>3. –ó–∞–¥—ñ—è–Ω–æ —Å–∏–ª –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;–ï–∫—ñ–ø–∞–∂—ñ–≤ ‚Äì 1</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;–ë–ø–õ–ê ‚Äì ${totalEventsCount}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–ª—å–æ—Ç—ñ–≤ ‚Äì ${totalEventsCount}</p>

<p>4. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –∑–∞ –¥–æ–±—É:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;–†–æ–∑–≤—ñ–¥–∫–∞ ‚Äì ${eventCounts['–†–æ–∑–≤—ñ–¥–∫–∞'] || ''}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;–ù–∞–Ω–µ—Å–µ–Ω–æ –≤–æ–≥–Ω–µ–≤–µ —É—Ä–∞–∂–µ–Ω–Ω—è –º—ñ—Å—Ü—å —Å–∫—É–ø—á–µ–Ω–Ω—è –æ/—Å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ ‚Äì ${infantryEventCount || ''}</p>
`;

            html += `\n<p>5. –í—Ç—Ä–∞—Ç–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:</p>\n`;
            
            if (infantryKills['200']) {
                html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–û\\c –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ 200 ‚Äì ${infantryKills['200']}</p>\n`;
            }
            if (infantryKills['300']) {
                html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–û\\c –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ 300 ‚Äì ${infantryKills['300']}</p>\n`;
            }
            
            Object.keys(targetSummary).forEach(key => {
                const count = targetSummary[key];
                if (key.startsWith('–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ_')) {
                    const targetName = key.replace('–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ_', '');
                    html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–ü–æ—à–∫–æ–¥–∂–µ–Ω–æ ${targetName} ‚Äì ${count}</p>\n`;
                } else {
                    html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;${key} ‚Äì ${count}</p>\n`;
                }
            });
            
            html += `\n<p>6. –í–∏—Ç—Ä–∞—Ç–∏ –ë–ö:</p>\n`;
            Object.entries(bkSummary).forEach(([type, count]) => {
                html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;${type} ‚Äì ${count} —à—Ç.</p>\n`;
            });
            
            html += `\n<p>7. –í—Ç—Ä–∞—Ç–∏:</p>\n`;
            html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–û—Å–æ–±–æ–≤–∏–π —Å–∫–ª–∞–¥ ‚Äì</p>\n`;
            html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–û—ñ–í–¢ ‚Äì</p>\n`;
            html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–î—Ä–æ–Ω–∏ ‚Äì ${totalEventsCount > 0 ? totalEventsCount : ''}</p>\n`;
            
            html += `\n<p>8. –ü—Ä–æ–±–ª–µ–º–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è:</p>\n`;
            html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;- –í–∏—Å–æ–∫–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–æ—Ä–æ–∂–∏—Ö FPV –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞—Ö</p>\n`;
            html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;- –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫—Ä–∏–ª</p>\n`;
            html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;- –¢—Ä—É–¥–Ω–æ—â—ñ –∑ –ª–æ–≥—ñ—Å—Ç–∏–∫–æ—é</p>\n`;
            
            html += `\n<p>9. –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –¥—ñ—ó:</p>\n`;
            html += `<p>&nbsp;</p>\n`;
            html += `<p>&nbsp;</p>\n`;
            
            
            const coordsText = positionCoords ? ` (${positionCoords})` : '';
            
            html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;<b>–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª–æ–º 2 –ë–ë–ø–° –¢–ó–ü FPV ¬´${positionName}¬ª${coordsText} –±—É–ª–æ –∑–¥—ñ–π—Å–Ω–µ–Ω–æ —É–¥–∞—Ä–∏ FPV-–¥—Ä–æ–Ω–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É ‚Äì ${events.length} ${timesText}.</b></p>\n`;
            
            const operator = document.getElementById('operator').value.trim();
            const secondPilot = document.getElementById('secondPilot').value.trim();
            const navigator = document.getElementById('navigator').value.trim();
            const engineer = document.getElementById('engineer').value.trim();
            
            const formatCrewName = (name) => {
                const parts = name.trim().split(/\s+/);
                
                if (parts.length === 0) return name;
                
                parts[0] = parts[0].toLowerCase();
                
                for (let i = 1; i < parts.length; i++) {
                    parts[i] = parts[i].charAt(0).toUpperCase() + parts[i].slice(1).toLowerCase();
                }
                
                return parts.join(' ');
            };
            
            if (operator) html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–æ–ø–µ—Ä–∞—Ç–æ—Ä ‚Äì ${formatCrewName(operator)}</p>\n`;
            if (secondPilot) html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;–¥—Ä—É–≥–∏–π –ø—ñ–ª–æ—Ç ‚Äì ${formatCrewName(secondPilot)}</p>\n`;
            if (navigator) html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;—à—Ç—É—Ä–º–∞–Ω ‚Äì ${formatCrewName(navigator)}</p>\n`;
            if (engineer) html += `<p>&nbsp;&nbsp;&nbsp;&nbsp;—ñ–Ω–∂–µ–Ω–µ—Ä –ë–ö ‚Äì ${formatCrewName(engineer)}</p>\n`;
            
            html += `<p>&nbsp;</p>\n`;
            html += `<p>–ü—Ä–æ—Ç—è–≥–æ–º –∑–≤—ñ—Ç–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É –∑ 16:00 ${yesterdayStr}—Ä. –ø–æ 16:00 ${dateStr}—Ä. –±—É–ª–æ –∑–¥—ñ–π—Å–Ω–µ–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω–µ:</p>\n`;
            
            const sortedEvents = [...events].sort((a, b) => {
                const timeA = parseTime(a.–Ω–µ–±–æ || a.—Å–∫–∏–¥ || a.–∑–µ–º–ª—è || '00:00');
                const timeB = parseTime(b.–Ω–µ–±–æ || b.—Å–∫–∏–¥ || b.–∑–µ–º–ª—è || '00:00');
                return timeA - timeB;
            });
            
            sortedEvents.forEach(event => {
                const timeText = event.–Ω–µ–±–æ || event.—Å–∫–∏–¥ || event.–∑–µ–º–ª—è || '—Ö—Ö:—Ö—Ö';
                let eventTypeLower = event.–ø–æ–¥—ñ—è.toLowerCase();
                if (eventTypeLower === '—Ä–æ–∑–≤—ñ–¥–∫–∞') {
                    eventTypeLower = '–ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è —Ä–æ–∑–≤—ñ–¥–∫–∏';
                }
                
                if (event.—Ü—ñ–ª—ñ && event.—Ü—ñ–ª—ñ.length > 0) {
                    const targetCoords = event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ ? ` –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (${event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏})` : ' –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (–•–•–• –•–• –•–•–•–•–• –•–•–•–•–•)';
                    
                    event.—Ü—ñ–ª—ñ.forEach(target => {
                        html += `<p>${timeText} ‚Äì —É—Ä–∞–∂–µ–Ω–Ω—è ${target.—Ç–∏–ø.toLowerCase()}${targetCoords}</p>\n`;
                    });
                } else {
                    let eventLine = timeText ? timeText + ' ‚Äì ' : '';
                    eventLine += eventTypeLower;
                    
                    if (event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏) {
                        eventLine += ` –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (${event.–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏})`;
                    } else {
                        eventLine += ' –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (–•–•–• –•–• –•–•–•–•–• –•–•–•–•–•)';
                    }
                    
                    html += `<p>${eventLine}</p>\n`;
                }
            });
            
            html += `</body></html>`;
            
            const blob = new Blob([html], { type: 'application/msword;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const fileDate = `${day}-${month}-${year}`;
            
            link.download = `fpv_${positionName}_${fileDate}.doc`;
            link.click();
        }
        
        window.onload = function() {
            
            const timeFields = ['field4', 'field5', 'field6'];
            timeFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                
                field.addEventListener('input', function(e) {
                    setTimeout(() => formatTimeInput(field), 0);
                });
                
                field.addEventListener('keydown', handleTimeBackspace);
            });
            
            const coordFields = ['positionCoords', 'field3'];
            coordFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                
                field.addEventListener('input', function(e) {
                    setTimeout(() => formatCoordinatesInput(field), 0);
                });
            });
        };
        
        function formatTimeInputDirect(field) {
            let cursorPos = field.selectionStart;
            let oldValue = field.value;
            
            let digits = field.value.replace(/\D/g, '');
            
            if (digits.length > 4) {
                digits = digits.slice(0, 4);
            }
            
            let formatted = '';
            if (digits.length >= 1) {
                formatted = digits.slice(0, 2);
            }
            if (digits.length >= 3) {
                formatted = digits.slice(0, 2) + ':' + digits.slice(2, 4);
            }
            
            field.value = formatted;
            
            if (oldValue.length < formatted.length && cursorPos === 2) {
                field.setSelectionRange(3, 3); // –ü—ñ—Å–ª—è –¥–≤–æ–∫—Ä–∞–ø–∫–∏
            }
        }
        
        function formatCoordinatesInputDirect(field) {
            formatCoordinatesInput(field);
        }
        
        function formatTimeInput(field) {
            let value = field.value.replace(/[^\d]/g, ''); // –ó–∞–ª–∏—à–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ü–∏—Ñ—Ä–∏
            
            if (value.length === 0) {
                field.value = '';
                return;
            }
            
            if (value.length > 4) {
                value = value.slice(0, 4);
            }
            
            if (value.length >= 2) {
                let hours = parseInt(value.slice(0, 2));
                if (hours > 23) {
                    hours = 23;
                }
                value = hours.toString().padStart(2, '0') + value.slice(2);
            }
            
            if (value.length >= 4) {
                let hours = value.slice(0, 2);
                let minutes = parseInt(value.slice(2, 4));
                if (minutes > 59) {
                    minutes = 59;
                }
                value = hours + minutes.toString().padStart(2, '0');
            }
            
            if (value.length >= 3) {
                value = value.slice(0, 2) + ':' + value.slice(2);
            }
            
            field.value = value;
        }
        
        function handleTimeBackspace(e) {
            if (e.key === 'Backspace') {
                const value = e.target.value;
                const cursorPos = e.target.selectionStart;
                
                if (cursorPos === 3 && value.charAt(2) === ':') {
                    e.preventDefault();
                    e.target.value = value.slice(0, 2);
                }
            }
        }
        
        function formatCoordinatesInput(eventOrField) {
            const field = eventOrField.target ? eventOrField.target : eventOrField;
            
            let value = field.value.replace(/\s/g, ''); // –í–∏–¥–∞–ª—è—î–º–æ –ø—Ä–æ–±—ñ–ª–∏
            
            if (value.length === 0) {
                field.value = '';
                return;
            }
            
            let formatted = '';
            
            for (let i = 0; i < value.length && i < 15; i++) {
                const char = value[i].toUpperCase();
                
                if (i < 2) {
                    if (/\d/.test(char)) {
                        formatted += char;
                    }
                } else if (i === 2) {
                    if (/[A-Z]/.test(char)) {
                        formatted += char;
                    }
                } else if (i >= 3 && i < 5) {
                    if (/[A-Z]/.test(char)) {
                        formatted += char;
                    }
                } else {
                    if (/\d/.test(char)) {
                        formatted += char;
                    }
                }
            }
            
            let result = '';
            if (formatted.length > 0) {
                result = formatted.slice(0, 3); // 37T
            }
            if (formatted.length >= 4) {
                result += ' ' + formatted.slice(3, 5); // BN
            }
            if (formatted.length >= 6) {
                result += ' ' + formatted.slice(5, 10); // 98978
            }
            if (formatted.length >= 11) {
                result += ' ' + formatted.slice(10, 15); // 89504
            }
            
            field.value = result;
        }
        
        function declineFlights(count) {
            const lastDigit = count % 10;
            const lastTwoDigits = count % 100;
            
            if (lastTwoDigits >= 11 && lastTwoDigits <= 14) {
                return '–ø–æ–ª—å–æ—Ç—ñ–≤';
            }
            
            if (lastDigit === 1) {
                return '–ø–æ–ª—ñ—Ç';
            }
            
            if (lastDigit >= 2 && lastDigit <= 4) {
                return '–ø–æ–ª—å–æ—Ç–∏';
            }
            
            return '–ø–æ–ª—å–æ—Ç—ñ–≤';
        }
        
        function declineTimes(count) {
            const lastDigit = count % 10;
            const lastTwoDigits = count % 100;
            
            if (lastTwoDigits >= 11 && lastTwoDigits <= 14) {
                return '—Ä–∞–∑—ñ–≤';
            }
            
            if (lastDigit === 1) {
                return '—Ä–∞–∑';
            }
            
            if (lastDigit >= 2 && lastDigit <= 4) {
                return '—Ä–∞–∑–∏';
            }
            
            return '—Ä–∞–∑—ñ–≤';
        }
    </script>
</body>
</html>
